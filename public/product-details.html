<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product Details - ZIKRIYA DARBAR FOOD PRODUCTS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script>
      tailwind.config = {
        theme: { extend: { fontFamily: { sans: ["Poppins", "sans-serif"] } } },
      };
    </script>
    <style>
      body {
        font-family: "Poppins", sans-serif;
      }
      .carousel-img {
        transition: transform 0.3s ease;
        width: 100%;
        height: 100%;
        object-fit: cover;
        background: #e5e7eb;
        display: block;
      }
      .carousel-img:hover {
        transform: scale(1.05);
      }
      .carousel-container {
        width: 100%;
        height: 500px;
        background: #e5e7eb;
        position: relative;
        overflow: hidden;
      }
      .loading-spinner {
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .stock-bar {
        transition: width 0.3s ease;
      }
      .price-animate {
        animation: pulse 0.5s ease-in-out;
      }
      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }
      .product-image-section {
        min-height: 500px;
      }
      .toast {
        animation: slideIn 0.3s ease-out;
      }
      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      /* MOBILE MENU FIXES */
      .mobile-menu-btn {
        background: transparent;
        border: none;
        padding: 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        z-index: 60;
        position: relative;
      }

      .mobile-menu-btn:hover {
        background: rgba(249, 115, 22, 0.2);
        border-radius: 4px;
      }

      /* Mobile Menu - Slide from top with smooth animation */
      #mobileMenu {
        display: none;
        position: fixed;
        top: 80px;
        left: 0;
        right: 0;
        background: linear-gradient(135deg, #ff6b35 0%, #f97316 100%);
        backdrop-filter: blur(10px);
        animation: slideDown 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        z-index: 50;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
      }

      #mobileMenu.active {
        display: block;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideUp {
        from {
          opacity: 1;
          transform: translateY(0);
        }
        to {
          opacity: 0;
          transform: translateY(-20px);
        }
      }

      #mobileMenu.closing {
        animation: slideUp 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
      }

      /* Menu Items Styling */
      #mobileMenu a,
      #mobileMenu button {
        color: white !important;
        font-weight: 600;
        transition: all 0.3s ease;
        padding: 15px 20px;
        display: block;
        width: 100%;
        text-align: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      #mobileMenu a:hover,
      #mobileMenu button:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: translateX(5px);
      }

      #mobileMenu a:active,
      #mobileMenu button:active {
        background: rgba(255, 255, 255, 0.25);
      }

      /* Icon Color */
      .mobile-menu-btn i {
        color: #f97316;
        transition: all 0.3s ease;
      }

      .mobile-menu-btn:hover i {
        color: #ea580c;
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <!-- Navbar -->
    <nav
      class="fixed top-0 w-full bg-white/95 backdrop-blur-md shadow-lg z-50 transition-all duration-300"
    >
      <div class="mx-auto px-0">
        <div class="flex justify-between items-center py-4">
          <div class="flex items-center space-x-6 pl-4 md:pl-8">
            <img
              src="/images/logo.jpeg"
              alt="Logo"
              class="h-24 w-24 object-contain rounded-full shadow-2xl border-4 border-orange-500 ring-4 ring-orange-200"
              onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22%3E%3Crect width=%22100%22 height=%22100%22 fill=%22%23f97316%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-family=%22Arial%22 font-size=%2224%22 fill=%22white%22%3EZD%3C/text%3E%3C/svg%3E';"
            />
            <h1
              class="text-2xl md:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-red-600 via-orange-500 to-yellow-600 tracking-wide"
            >
              ZIKRIYA DARBAR FOOD PRODUCTS
            </h1>
          </div>
          <div class="hidden md:flex items-center space-x-8 pr-4 md:pr-8">
            <a
              href="index.html"
              class="text-gray-700 hover:text-orange-600 font-medium transition duration-300 text-lg"
              >Home</a
            >
            <a
              href="index.html#products"
              class="text-gray-700 hover:text-orange-600 font-medium transition duration-300 text-lg"
              >Products</a
            >
            <a
              href="About.html"
              class="text-gray-700 hover:text-orange-600 font-medium transition duration-300 text-lg"
              >About Us</a
            >
            <a
              href="contact.html"
              class="text-gray-700 hover:text-orange-600 font-medium transition duration-300 text-lg"
              >Contact Us</a
            >
          </div>

          <!-- Mobile Menu Button -->
          <button
            id="mobileMenuBtn"
            class="md:hidden mobile-menu-btn mr-4"
            aria-label="Toggle Menu"
          >
            <i class="fas fa-bars text-3xl"></i>
          </button>
        </div>
      </div>

      <!-- Mobile Menu -->
      <div id="mobileMenu" class="md:hidden">
        <a href="index.html">Home</a>
        <a href="index.html#products">Products</a>
        <a href="About.html">About Us</a>
        <a href="contact.html">Contact Us</a>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="pt-32 pb-16 px-4 md:px-8">
      <div id="loadingSpinner" class="flex justify-center items-center h-96">
        <div
          class="loading-spinner border-8 border-t-8 border-gray-200 border-t-orange-600 rounded-full w-16 h-16"
        ></div>
      </div>

      <div id="productContent" class="hidden max-w-7xl mx-auto">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <!-- Left Column - Images -->
          <div class="product-image-section">
            <div class="carousel-container rounded-lg overflow-hidden mb-4">
              <div id="carousel" class="relative w-full h-full"></div>
              <button
                onclick="changeSlide(-1)"
                class="absolute left-2 top-1/2 -translate-y-1/2 bg-black/50 text-white p-3 rounded-full hover:bg-black/70 transition"
              >
                <i class="fas fa-chevron-left"></i>
              </button>
              <button
                onclick="changeSlide(1)"
                class="absolute right-2 top-1/2 -translate-y-1/2 bg-black/50 text-white p-3 rounded-full hover:bg-black/70 transition"
              >
                <i class="fas fa-chevron-right"></i>
              </button>
            </div>

            <!-- Thumbnails -->
            <div
              id="thumbsContainer"
              class="flex gap-2 overflow-x-auto pb-2"
            ></div>
          </div>

          <!-- Right Column - Details -->
          <div class="bg-white rounded-lg shadow-lg p-6">
            <span
              id="productCategory"
              class="inline-block bg-orange-100 text-orange-600 px-3 py-1 rounded-full text-sm font-semibold mb-3"
            ></span>

            <h1
              id="productName"
              class="text-4xl font-bold mb-4 text-gray-800"
            ></h1>

            <div class="flex items-baseline gap-4 mb-4">
              <span
                id="productPrice"
                class="text-3xl font-bold text-green-600"
              ></span>
              <span
                id="productDiscount"
                class="text-xl text-gray-400 line-through"
              ></span>
            </div>

            <div class="flex items-center mb-4">
              <div class="flex text-yellow-400 mr-2">
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star-half-alt"></i>
              </div>
              <span class="text-gray-600">(4.8/5)</span>
            </div>

            <div
              id="productDescription"
              class="text-gray-700 mb-6 leading-relaxed"
            ></div>

            <!-- Stock Info -->
            <div class="mb-6">
              <div class="flex justify-between items-center mb-2">
                <span
                  id="productStock"
                  class="text-green-600 font-semibold"
                ></span>
                <span class="text-sm text-gray-500"
                  ><span id="maxStock"></span> units available</span
                >
              </div>
              <div class="w-full bg-gray-200 rounded-full h-2">
                <div
                  id="stockBar"
                  class="stock-bar bg-gradient-to-r from-green-500 to-green-600 h-2 rounded-full"
                  style="width: 0%"
                ></div>
              </div>
            </div>

            <!-- Quantity Selector -->
            <div class="flex items-center gap-4 mb-6">
              <label class="font-semibold text-gray-700">Quantity:</label>
              <div class="flex items-center border border-gray-300 rounded-lg">
                <button
                  id="minusBtn"
                  onclick="changeQty(-1)"
                  class="px-4 py-2 text-xl hover:bg-gray-100 transition"
                >
                  -
                </button>
                <input
                  id="qtyInput"
                  type="number"
                  value="1"
                  min="1"
                  class="w-16 text-center border-x border-gray-300 py-2 outline-none"
                  onchange="updateQty()"
                />
                <button
                  id="plusBtn"
                  onclick="changeQty(1)"
                  class="px-4 py-2 text-xl hover:bg-gray-100 transition"
                >
                  +
                </button>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="grid grid-cols-2 gap-4 mb-4">
              <button
                onclick="addToCart()"
                class="bg-orange-600 text-white py-3 rounded-lg font-semibold hover:bg-orange-700 transition shadow-lg"
              ></button>
              <button
                onclick="buyNow()"
                class="bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition shadow-lg"
              >
                <i class="fas fa-bolt mr-2"></i>Buy Now
              </button>
            </div>

            <button
              onclick="downloadPDF()"
              class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition shadow-lg"
            >
              <i class="fas fa-download mr-2"></i>Download Details (PDF)
            </button>

            <!-- Product Info -->
            <div class="mt-6 border-t pt-4">
              <div class="grid grid-cols-2 gap-4 text-sm">
                <div>
                  <span class="text-gray-500">SKU:</span>
                  <span id="productSKU" class="font-semibold ml-2"></span>
                </div>
                <div>
                  <span class="text-gray-500">Category:</span>
                  <span id="productCat2" class="font-semibold ml-2"></span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div
      id="toast"
      class="fixed top-24 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg hidden toast z-50"
    >
      <i class="fas fa-check-circle mr-2"></i>
      <span id="toastMessage"></span>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-12">
      <div class="max-w-7xl mx-auto px-6">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-8">
          <div>
            <h3 class="text-xl font-bold mb-4 text-orange-500">
              ZIKRIYA DARBAR FOOD PRODUCTS
            </h3>
            <p class="text-gray-400 leading-relaxed">
              Premium B2B spices and food products. Quality you can trust,
              flavors you'll love.
            </p>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Quick Links</h4>
            <ul class="space-y-2 text-gray-400">
              <li>
                <a href="index.html" class="hover:text-white transition"
                  >Home</a
                >
              </li>
              <li>
                <a
                  href="index.html#products"
                  class="hover:text-white transition"
                  >Products</a
                >
              </li>
              <li>
                <a href="About.html" class="hover:text-white transition"
                  >About Us</a
                >
              </li>
              <li>
                <a href="contact.html" class="hover:text-white transition"
                  >Contact</a
                >
              </li>
            </ul>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Support</h4>
            <ul class="space-y-2 text-gray-400">
              <li><a href="#" class="hover:text-white transition">FAQ</a></li>
              <li>
                <a href="#" class="hover:text-white transition">Shipping</a>
              </li>
              <li>
                <a href="#" class="hover:text-white transition">Returns</a>
              </li>
              <li>
                <a href="#" class="hover:text-white transition"
                  >Privacy Policy</a
                >
              </li>
            </ul>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Follow Us</h4>
            <div class="flex space-x-4">
              <a href="#" class="text-gray-400 hover:text-white transition"
                ><i class="fab fa-facebook-f text-xl"></i
              ></a>
              <a href="#" class="text-gray-400 hover:text-white transition"
                ><i class="fab fa-instagram text-xl"></i
              ></a>
              <a href="#" class="text-gray-400 hover:text-white transition"
                ><i class="fab fa-twitter text-xl"></i
              ></a>
            </div>
            <p class="text-sm text-gray-400 mt-4">
              Contact: 03327372364 | Email: info@zdspices.pk
            </p>
          </div>
        </div>
        <div
          class="border-t border-gray-700 mt-8 pt-4 text-center text-gray-400"
        >
          <p>
            Â© 2025 ZIKRIYA DARBAR FOOD PRODUCTS. All rights reserved. | Made
            with love in Pakistan
          </p>
        </div>
      </div>
    </footer>

    <script>
      // API Configuration - Auto-detect localhost or production
      const API_BASE = window.location.hostname.includes("zdspices.pk")
        ? "https://api.zdspices.pk"
        : `http://${window.location.hostname}:5000`;

      console.log("API Base URL:", API_BASE);

      let currentProduct = null;
      let currentSlide = 0;
      let qty = 1;
      let menuOpen = false;

      // Mobile Menu Functions - FIXED
      function toggleMobileMenu(event) {
        if (event) {
          event.stopPropagation();
        }

        const menu = document.getElementById("mobileMenu");
        const btn = document.getElementById("mobileMenuBtn");

        if (!menu || !btn) return;

        menuOpen = !menuOpen;

        if (menuOpen) {
          menu.classList.remove("closing");
          menu.classList.add("active");
          btn.innerHTML = '<i class="fas fa-times text-3xl"></i>';
        } else {
          menu.classList.add("closing");
          setTimeout(() => {
            menu.classList.remove("active");
            menu.classList.remove("closing");
            btn.innerHTML = '<i class="fas fa-bars text-3xl"></i>';
          }, 300);
        }
      }

      function closeMobileMenu() {
        const menu = document.getElementById("mobileMenu");
        const btn = document.getElementById("mobileMenuBtn");

        if (!menu || !btn || !menuOpen) return;

        menuOpen = false;
        menu.classList.add("closing");
        setTimeout(() => {
          menu.classList.remove("active");
          menu.classList.remove("closing");
          btn.innerHTML = '<i class="fas fa-bars text-3xl"></i>';
        }, 300);
      }

      // Setup mobile menu with proper event handling
      document.addEventListener("DOMContentLoaded", function () {
        const mobileMenuBtn = document.getElementById("mobileMenuBtn");
        const mobileMenu = document.getElementById("mobileMenu");

        if (mobileMenuBtn) {
          mobileMenuBtn.addEventListener("click", toggleMobileMenu);
        }

        // Close menu when clicking on menu links
        if (mobileMenu) {
          const menuLinks = mobileMenu.querySelectorAll("a");
          menuLinks.forEach((link) => {
            link.addEventListener("click", closeMobileMenu);
          });
        }

        // Close menu when clicking outside - but not immediately
        document.addEventListener("click", function (e) {
          if (!mobileMenu || !mobileMenuBtn) return;

          // Check if click is outside both menu and button
          if (
            !mobileMenu.contains(e.target) &&
            !mobileMenuBtn.contains(e.target) &&
            menuOpen
          ) {
            closeMobileMenu();
          }
        });

        // Close menu on scroll
        let scrollTimeout;
        window.addEventListener("scroll", function () {
          if (menuOpen) {
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
              closeMobileMenu();
            }, 100);
          }
        });
      });

      // Get image URL with proper fallback
      function getImageUrl(img) {
        if (!img)
          return "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='500' height='500'%3E%3Crect width='500' height='500' fill='%23e5e7eb'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='24' fill='%239ca3af'%3ENo Image%3C/text%3E%3C/svg%3E";

        const imgStr = String(img).trim();

        if (imgStr.startsWith("data:image")) return imgStr;
        if (imgStr.startsWith("http")) return imgStr;
        if (imgStr)
          return `${API_BASE}${imgStr.startsWith("/") ? imgStr : "/" + imgStr}`;

        return "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='500' height='500'%3E%3Crect width='500' height='500' fill='%23e5e7eb'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='24' fill='%239ca3af'%3ENo Image%3C/text%3E%3C/svg%3E";
      }

      // Load product from URL
      async function loadProduct() {
        const params = new URLSearchParams(window.location.search);
        const id = params.get("id");

        if (!id) {
          document.getElementById("loadingSpinner").innerHTML =
            '<p class="text-red-600 text-xl">Product not found</p>';
          return;
        }

        try {
          const res = await fetch(`${API_BASE}/api/products/${id}`);
          if (!res.ok) throw new Error("Product not found");

          currentProduct = await res.json();
          document.title = `${currentProduct.name} - ZIKRIYA DARBAR`;

          renderProduct();
        } catch (err) {
          console.error(err);
          document.getElementById("loadingSpinner").innerHTML =
            '<p class="text-red-600 text-xl">Error loading product</p>';
        }
      }

      function renderProduct() {
        document.getElementById("loadingSpinner").classList.add("hidden");
        document.getElementById("productContent").classList.remove("hidden");

        document.getElementById("productName").textContent =
          currentProduct.name;
        document.getElementById("productCategory").textContent =
          currentProduct.category || "General";
        document.getElementById("productDescription").innerHTML =
          currentProduct.description
            ? currentProduct.description.replace(/\n/g, "<br>")
            : "No description";

        const price = currentProduct.price || 0;
        const discount = currentProduct.discount || 0;
        const discountedPrice = price * (1 - discount / 100);

        document.getElementById(
          "productPrice"
        ).textContent = `Rs ${discountedPrice.toFixed(0)}`;
        document.getElementById("productDiscount").textContent =
          discount > 0 ? `Rs ${price.toFixed(0)}` : "";

        const stock = currentProduct.stock || 0;
        const stockPercent = stock > 0 ? Math.min((stock / 100) * 100, 100) : 0;
        document.getElementById("stockBar").style.width = stockPercent + "%";
        document.getElementById("productStock").textContent =
          stock > 0 ? "In Stock" : "Out of Stock";
        document.getElementById("maxStock").textContent = stock;

        document.getElementById("productSKU").textContent =
          currentProduct.sku || "N/A";
        document.getElementById("productCat2").textContent =
          currentProduct.category || "General";

        loadCarousel();
        updateQtyButtons();
      }

      function loadCarousel() {
        const images =
          currentProduct.images && currentProduct.images.length > 0
            ? currentProduct.images.map((img) => getImageUrl(img))
            : [
                "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='500' height='500'%3E%3Crect width='500' height='500' fill='%23e5e7eb'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='24' fill='%239ca3af'%3ENo Image%3C/text%3E%3C/svg%3E",
              ];

        const carousel = document.getElementById("carousel");
        const thumbs = document.getElementById("thumbsContainer");

        carousel.innerHTML = images
          .map(
            (img, i) => `
          <img src="${img}" alt="Product" class="carousel-img absolute inset-0" style="display: ${
              i === 0 ? "block" : "none"
            };" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22500%22 height=%22500%22%3E%3Crect width=%22500%22 height=%22500%22 fill=%22%23e5e7eb%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-family=%22Arial%22 font-size=%2224%22 fill=%22%239ca3af%22%3ENo Image%3C/text%3E%3C/svg%3E';">
        `
          )
          .join("");

        thumbs.innerHTML = images
          .map(
            (img, i) => `
          <img src="${img}" alt="Thumbnail" 
            class="w-20 h-20 object-cover rounded cursor-pointer border-2 ${
              i === 0 ? "border-orange-500" : "border-gray-300"
            } hover:border-orange-500 transition"
            onclick="jumpToSlide(${i})"
            onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22%3E%3Crect width=%22100%22 height=%22100%22 fill=%22%23e5e7eb%22/%3E%3C/svg%3E';">
        `
          )
          .join("");
      }

      function changeSlide(dir) {
        const images = document.querySelectorAll("#carousel img");
        if (images.length === 0) return;

        images[currentSlide].style.display = "none";
        currentSlide = (currentSlide + dir + images.length) % images.length;
        images[currentSlide].style.display = "block";
        updateThumbnails();
      }

      function jumpToSlide(index) {
        const images = document.querySelectorAll("#carousel img");
        if (images.length === 0) return;

        images[currentSlide].style.display = "none";
        currentSlide = index;
        images[currentSlide].style.display = "block";
        updateThumbnails();
      }

      function updateThumbnails() {
        const thumbs = document.querySelectorAll("#thumbsContainer img");
        thumbs.forEach((thumb, i) => {
          thumb.classList.toggle("border-orange-500", i === currentSlide);
          thumb.classList.toggle("border-gray-300", i !== currentSlide);
        });
      }

      function changeQty(delta) {
        const input = document.getElementById("qtyInput");
        const newQty = Math.max(1, parseInt(input.value || 1) + delta);
        const stock = currentProduct?.stock || 0;

        if (newQty <= stock) {
          qty = newQty;
          input.value = qty;
          updateQtyButtons();
        } else {
          showToast("Maximum stock reached!");
        }
      }

      function updateQty() {
        const input = document.getElementById("qtyInput");
        const stock = currentProduct?.stock || 0;
        const newQty = Math.max(1, Math.min(parseInt(input.value || 1), stock));

        qty = newQty;
        input.value = qty;
        updateQtyButtons();
      }

      function updateQtyButtons() {
        const stock = currentProduct?.stock || 0;
        document.getElementById("minusBtn").disabled = qty <= 1;
        document.getElementById("plusBtn").disabled = qty >= stock;
      }

      function addToCart() {
        if (!currentProduct) return;
        showToast(`${qty} x ${currentProduct.name} added to cart!`);
      }

      function buyNow() {
        if (!currentProduct) return;
        showToast(`Proceeding to checkout with ${qty} items...`);
        setTimeout(() => {
          window.location.href = "contact.html";
        }, 1500);
      }

      function showToast(message) {
        const toast = document.getElementById("toast");
        const toastMessage = document.getElementById("toastMessage");
        toastMessage.textContent = message;
        toast.classList.remove("hidden");
        setTimeout(() => {
          toast.classList.add("hidden");
        }, 3000);
      }

      function downloadPDF() {
        if (!currentProduct) return;

        try {
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();

          doc.setFontSize(22);
          doc.text("ZIKRIYA DARBAR FOOD PRODUCTS", 105, 20, {
            align: "center",
          });

          doc.setFontSize(16);
          doc.text(currentProduct.name, 20, 40);

          doc.setFontSize(12);
          doc.text(`Category: ${currentProduct.category || "N/A"}`, 20, 55);
          doc.text(`SKU: ${currentProduct.sku || "N/A"}`, 20, 65);
          doc.text(`Price: Rs ${currentProduct.price || 0}`, 20, 75);
          doc.text(`Stock: ${currentProduct.stock || 0} units`, 20, 85);

          doc.text("Description:", 20, 100);
          const desc = currentProduct.description || "No description available";
          const splitDesc = doc.splitTextToSize(desc, 170);
          doc.text(splitDesc, 20, 110);

          doc.save(`${currentProduct.name.replace(/\s+/g, "_")}_Details.pdf`);
          showToast("PDF downloaded successfully!");
        } catch (error) {
          console.error("PDF Error:", error);
          showToast("Error generating PDF");
        }
      }

      // Initialize
      window.addEventListener("DOMContentLoaded", loadProduct);
    </script>
  </body>
</html>

<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ZIKRIYA DARBAR FOOD PRODUCTS - Premium B2B Spices & Food</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: { extend: { fontFamily: { sans: ["Poppins", "sans-serif"] } } },
      };

      const API_BASE = "https://api.zdspices.pk";
    </script>
    <style>
      .hero-bg {
        background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)),
          url("https://thumbs.dreamstime.com/b/dry-colorful-spices-spoons-bowls-fresh-seasoning-dark-rustic-wooden-background-top-view-border-59439636.jpg");
        background-size: cover;
      }
      .card-hover {
        transition: all 0.4s ease;
      }
      .card-hover:hover {
        transform: translateY(-10px) scale(1.02);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
      }
      .stock-bar {
        background: linear-gradient(to right, #10b981, #059669);
      }
      .line-clamp-1 {
        display: -webkit-box;
        -webkit-line-clamp: 1;
        -webkit-box-orient: vertical;
        overflow: hidden;
        line-clamp: 1;
      }
      .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        line-clamp: 2;
      }
      @keyframes secretPulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }
      .secret-active {
        animation: secretPulse 0.3s ease-in-out;
      }

      /* PRODUCT IMAGE FIX */
      .product-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        background: #e5e7eb;
        display: block;
      }

      .product-img-container {
        width: 100%;
        height: 224px;
        background: #e5e7eb;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Mobile menu button fix */
      .mobile-menu-btn {
        background: transparent;
        border: none;
        padding: 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .mobile-menu-btn:hover {
        background: rgba(0, 0, 0, 0.1);
        border-radius: 4px;
      }

      /* Mobile menu smooth */
      #mobileMenu {
        transition: max-height 0.3s ease-in-out;
        max-height: 0;
        overflow: hidden;
      }

      #mobileMenu:not(.hidden) {
        max-height: 500px;
      }
    </style>
  </head>
  <body
    class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-sans transition-all duration-300"
  >
    <!-- NAVBAR -->
    <nav
      class="fixed top-0 w-full bg-white/95 backdrop-blur-md shadow-lg z-50 transition-all duration-300"
    >
      <div class="mx-auto px-0">
        <div class="flex justify-between items-center py-4">
          <div class="flex items-center space-x-6 pl-4 md:pl-8">
            <img
              id="secretAdminLogo"
              src="/images/logo.jpeg"
              alt="ZIKRIYA DARBAR FOOD PRODUCTS Logo"
              class="h-24 w-24 object-contain rounded-full shadow-2xl border-4 border-orange-500 ring-4 ring-orange-200 cursor-pointer"
              onclick="handleSecretAdminAccess()"
              onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22%3E%3Crect width=%22100%22 height=%22100%22 fill=%22%23f97316%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-family=%22Arial%22 font-size=%2224%22 fill=%22white%22%3EZD%3C/text%3E%3C/svg%3E';"
            />
            <h1
              class="text-2xl md:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-red-600 via-orange-500 to-yellow-600 tracking-wide"
            >
              ZIKRIYA DARBAR FOOD PRODUCTS
            </h1>
          </div>

          <div class="hidden md:flex items-center space-x-8 pr-4 md:pr-8">
            <a
              href="#home"
              class="text-gray-700 hover:text-orange-600 font-medium transition duration-300 text-lg"
            >
              Home
            </a>
            <a
              href="#products"
              class="text-gray-700 hover:text-orange-600 font-medium transition duration-300 text-lg"
            >
              Products
            </a>
            <a
              href="About.html"
              class="text-gray-700 hover:text-orange-600 font-medium transition duration-300 text-lg"
            >
              About Us
            </a>
            <a
              href="contact.html"
              class="text-gray-700 hover:text-orange-600 font-medium transition duration-300 text-lg"
            >
              Contact Us
            </a>
          </div>

          <div class="md:hidden flex items-center space-x-4 pr-4">
            <button class="mobile-menu-btn" id="mobileMenuBtn">
              <i class="fas fa-bars text-2xl text-gray-700"></i>
            </button>
          </div>
        </div>

        <!-- Mobile Menu -->
        <div
          id="mobileMenu"
          class="hidden md:hidden absolute top-full left-0 w-full bg-white backdrop-blur-lg shadow-2xl border-t-2 border-orange-200"
        >
          <div class="flex flex-col items-center py-8 space-y-6 bg-white">
            <a
              href="#home"
              class="text-xl font-medium text-gray-700 hover:text-orange-600 transition"
              >Home</a
            >
            <a
              href="#products"
              class="text-xl font-medium text-gray-700 hover:text-orange-600 transition"
              >Products</a
            >
            <a
              href="/About.html"
              class="text-xl font-medium text-gray-700 hover:text-orange-600 transition"
              >About Us</a
            >
            <a
              href="/contact.html"
              class="text-xl font-medium text-gray-700 hover:text-orange-600 transition"
              >Contact Us</a
            >
          </div>
        </div>
      </div>
    </nav>

    <!-- Hero Section -->
    <section
      id="home"
      class="hero-bg h-screen flex items-center justify-center text-white pt-16"
    >
      <div class="text-center px-4">
        <h1 class="text-5xl md:text-7xl font-bold text-white mb-6">
          Premium <span class="text-orange-400">Spices</span> & Fresh
          <span class="text-orange-400">Seafood</span>
        </h1>
        <p class="text-2xl md:text-3xl mb-12 max-w-3xl mx-auto leading-relaxed">
          Wholesale Quality. Authentic Taste. Direct from Source.
        </p>
        <button
          class="bg-gradient-to-r from-red-600 to-orange-600 text-white px-12 py-5 rounded-full text-xl font-bold hover:from-red-700 hover:to-orange-700 shadow-2xl transform hover:scale-105 transition-all duration-300"
        >
          Explore Products <i class="fas fa-arrow-down ml-3"></i>
        </button>
      </div>
    </section>

    <!-- Products Section -->
    <section id="products" class="py-20 bg-gray-50 dark:bg-gray-800">
      <div class="container mx-auto px-6">
        <h2
          class="text-5xl font-bold text-center mb-4 text-gray-800 dark:text-white"
        >
          Our Fresh Products
        </h2>
        <p class="text-center text-gray-600 dark:text-gray-300 text-xl mb-12">
          Premium quality spices and seafood for your business
        </p>

        <!-- Search & Filter -->
        <div class="flex flex-col md:flex-row gap-4 mb-12 max-w-4xl mx-auto">
          <input
            type="text"
            id="search"
            placeholder="Search products..."
            class="flex-1 px-6 py-4 rounded-2xl border-2 border-gray-300 dark:border-gray-600 dark:bg-gray-700 focus:border-orange-500 text-lg"
          />
          <select
            id="categoryFilter"
            class="px-6 py-4 rounded-2xl border-2 border-gray-300 dark:border-gray-600 dark:bg-gray-700 focus:border-orange-500 text-lg"
          >
            <option value="">All Categories</option>
            <option value="Spices">Spices</option>
            <option value="Fish">Fish</option>
            <option value="Seafood">Seafood</option>
          </select>
        </div>

        <!-- Products Grid -->
        <div
          id="productsGrid"
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"
        >
          <p class="col-span-full text-center py-12 text-xl text-gray-500">
            Loading products...
          </p>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-20">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid md:grid-cols-4 gap-8">
          <div>
            <h3 class="text-lg font-bold mb-4 flex items-center">
              ZIKRIYA DARBAR FOOD PRODUCTS
            </h3>
            <p class="text-gray-400">
              Premium spices & fish for B2B. Fresh, authentic, delivered fast.
            </p>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Quick Links</h4>
            <ul class="space-y-2 text-gray-400">
              <li>
                <a href="#home" class="hover:text-white transition">Home</a>
              </li>
              <li>
                <a href="#products" class="hover:text-white transition"
                  >Products</a
                >
              </li>
              <li>
                <a href="/About.html" class="hover:text-white transition"
                  >About Us</a
                >
              </li>
              <li>
                <a href="/contact.html" class="hover:text-white transition"
                  >Contact</a
                >
              </li>
            </ul>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Support</h4>
            <ul class="space-y-2 text-gray-400">
              <li><a href="#" class="hover:text-white transition">FAQ</a></li>
              <li>
                <a href="#" class="hover:text-white transition">Shipping</a>
              </li>
              <li>
                <a href="#" class="hover:text-white transition">Returns</a>
              </li>
              <li>
                <a href="#" class="hover:text-white transition"
                  >Privacy Policy</a
                >
              </li>
            </ul>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Follow Us</h4>
            <div class="flex space-x-4">
              <a href="#" class="text-gray-400 hover:text-white transition"
                ><i class="fab fa-facebook-f text-xl"></i
              ></a>
              <a href="#" class="text-gray-400 hover:text-white transition"
                ><i class="fab fa-instagram text-xl"></i
              ></a>
              <a href="#" class="text-gray-400 hover:text-white transition"
                ><i class="fab fa-twitter text-xl"></i
              ></a>
            </div>
            <p class="text-sm text-gray-400 mt-4">
              Contact: 03327372364 | Email: zdspices@gmail.com
            </p>
          </div>
        </div>
        <div
          class="border-t border-gray-700 mt-8 pt-4 text-center text-gray-400"
        >
          <p>
            &copy; 2025 ZIKRIYA DARBAR FOOD PRODUCTS. All rights reserved. |
            Made with ‚ù§Ô∏è in Pakistan
          </p>
        </div>
      </div>
    </footer>

    <script>
      let products = [];
      let secretClickCount = 0;
      let secretClickTimer = null;

      // SECRET ADMIN ACCESS
      function handleSecretAdminAccess() {
        secretClickCount++;
        const logo = document.getElementById("secretAdminLogo");
        logo.classList.add("secret-active");
        setTimeout(() => logo.classList.remove("secret-active"), 300);

        if (secretClickTimer) clearTimeout(secretClickTimer);
        secretClickTimer = setTimeout(() => {
          secretClickCount = 0;
        }, 3000);

        if (secretClickCount === 5) {
          confetti({
            particleCount: 150,
            spread: 70,
            origin: { y: 0.6 },
          });

          setTimeout(() => {
            const hasToken = localStorage.getItem("adminToken");
            if (hasToken) {
              window.location.href = "/admin/dashboard.html";
            } else {
              window.location.href = "/admin/login.html";
            }
          }, 500);

          secretClickCount = 0;
        }
      }

      function goToDetails(id) {
        window.location.href = `/product-details.html?id=${id}`;
      }

      // IMAGE URL DETECTION - FIXED
      function getImageUrl(img) {
        if (!img) return getPlaceholderImage();

        const imgStr = String(img).trim();

        // If base64 data URL
        if (imgStr.startsWith("data:image")) {
          return imgStr;
        }

        // If HTTP URL
        if (imgStr.startsWith("http")) {
          return imgStr;
        }

        // If file path
        if (imgStr) {
          return `${API_BASE}${imgStr.startsWith("/") ? imgStr : "/" + imgStr}`;
        }

        return getPlaceholderImage();
      }

      function getPlaceholderImage() {
        return "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='200'%3E%3Crect width='300' height='200' fill='%23e5e7eb'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='18' fill='%239ca3af'%3ENo Image%3C/text%3E%3C/svg%3E";
      }

      // Load Products - FIXED IMAGE HANDLING
      async function loadProducts() {
        const search = document.getElementById("search").value.toLowerCase();
        const category = document.getElementById("categoryFilter").value;

        try {
          console.log("üì° Loading products from:", `${API_BASE}/api/products`);
          const res = await fetch(`${API_BASE}/api/products`);

          if (!res.ok) {
            throw new Error(`HTTP error! status: ${res.status}`);
          }

          const data = await res.json();
          console.log("‚úÖ Products loaded:", data);

          if (Array.isArray(data)) {
            products = data;
          } else if (data.products && Array.isArray(data.products)) {
            products = data.products;
          } else if (data.data && Array.isArray(data.data)) {
            products = data.data;
          } else {
            console.error("Invalid API response format:", data);
            products = [];
          }

          let filtered = products.filter(
            (p) =>
              p.name.toLowerCase().includes(search) &&
              (!category || p.category === category)
          );

          displayProducts(filtered);
        } catch (error) {
          console.error("‚ùå Load error:", error);
          displayProducts([]);

          const grid = document.getElementById("productsGrid");
          grid.innerHTML = `
            <div class="col-span-full text-center py-12">
              <i class="fas fa-exclamation-triangle text-5xl text-red-500 mb-4"></i>
              <p class="text-xl text-gray-700 dark:text-gray-300 mb-2">Unable to load products</p>
              <p class="text-gray-500 dark:text-gray-400">Please check your connection or try again later</p>
            </div>
          `;
        }
      }

      function displayProducts(prods) {
        const grid = document.getElementById("productsGrid");

        if (prods.length === 0) {
          grid.innerHTML =
            '<p class="col-span-full text-center text-gray-500 dark:text-gray-400 py-12 text-xl">No products found. Check back soon!</p>';
          return;
        }

        grid.innerHTML = prods
          .map((p) => {
            const discountedPrice =
              p.price - (p.price * (p.discount || 0)) / 100;

            // Get first image with proper handling
            const firstImg =
              p.images && p.images.length > 0
                ? getImageUrl(p.images[0])
                : getPlaceholderImage();

            const stockPercent =
              p.stock > 0 ? Math.min((p.stock / 100) * 100, 100) : 0;

            return `
              <div class="card-hover bg-white dark:bg-gray-800 rounded-2xl overflow-hidden shadow-lg cursor-pointer border border-gray-200 dark:border-gray-700 hover:border-blue-300 transition-colors" onclick="goToDetails('${
                p._id
              }')">
                <div class="product-img-container">
                  <img src="${firstImg}" alt="${
              p.name
            }" class="product-img" onerror="this.src='${getPlaceholderImage()}'">
                </div>
                <div class="p-6">
                  <h3 class="font-bold text-xl mb-3 line-clamp-1">${p.name}</h3>
                  <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-2">${
                    p.description ||
                    "Premium quality product sourced directly from farms."
                  }</p>
                  <div class="flex justify-between items-center mb-4">
                    <span class="text-2xl font-bold text-green-600">Rs ${discountedPrice.toFixed(
                      0
                    )}</span>
                    ${
                      p.discount > 0
                        ? `<span class="text-gray-400 line-through text-lg">Rs ${p.price}</span>`
                        : ""
                    }
                  </div>
                  ${
                    p.discount > 0
                      ? `<div class="absolute top-4 left-4 bg-gradient-to-r from-red-500 to-pink-500 text-white px-3 py-1 rounded-full text-sm font-bold shadow-lg">-${p.discount}% OFF</div>`
                      : ""
                  }
                  <div class="mb-4">
                    <div class="flex items-center mb-2">
                      <div class="flex text-yellow-400">
                        <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                      </div>
                      <span class="ml-2 text-sm text-gray-500">4.8 (12 reviews)</span>
                    </div>
                  </div>
                  <div class="mb-4">
                    <p class="text-sm text-gray-600 mb-1">Stock Available</p>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                      <div class="stock-bar h-2 rounded-full transition-all duration-300" style="width: ${stockPercent}%"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">${
                      p.stock || 0
                    } units left</p>
                  </div>
                  <p class="text-xs text-gray-500 mb-2">${
                    p.category
                  } | <span class="font-mono">SKU: ${p.sku || "N/A"}</span></p>
                </div>
              </div>
            `;
          })
          .join("");
      }

      function scrollToProducts() {
        document
          .getElementById("products")
          .scrollIntoView({ behavior: "smooth" });
      }

      // Initialize on page load
      window.addEventListener("DOMContentLoaded", () => {
        loadProducts();
      });

      // Search and filter listeners
      document.getElementById("search").addEventListener("input", loadProducts);
      document
        .getElementById("categoryFilter")
        .addEventListener("change", loadProducts);
    </script>

    <!-- Load navbar script -->
    <script src="js/navbar.js"></script>
  </body>
</html>
